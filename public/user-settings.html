<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Title of the document</title>

	<!-- BS & jQuery -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Titillium+Web:400,700" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<!-- Our CSS -->
	<link rel="stylesheet" href="css/global.css">
</head>

<body>
<header>
	<h2 id="header-title">Witekio Coffee</h2>
</header>

<div id="page" class="col-md-12">

	<!-- Title -->
	<h3>Please choose your coffee on the machine.</h3>
</br></br>

	<form id="settings-form" class="form-horizontal">
	<fieldset>

	<!-- Title -->
	<legend>Settings</legend>

	<!-- Coffee liking -->
	<!-- <div class="form-group">
	  <label class="col-md-4 control-label" for="review">How did you like your coffee ?</label>
	  <div class="col-md-4">
		<label class="radio-inline" for="review-0">
		  <input type="radio" name="review" id="review-0" value="1" checked="checked">
		  Yuck !
		</label>
		<label class="radio-inline" for="review-1">
		  <input type="radio" name="review" id="review-1" value="2">
		  Meh
		</label>
		<label class="radio-inline" for="review-2">
		  <input type="radio" name="review" id="review-2" value="3">
		  Not bad
		</label>
		<label class="radio-inline" for="review-3">
		  <input type="radio" name="review" id="review-3" value="4">
		  Good !
		</label>
	  </div>
  </div>-->

	<!-- Name -->
	<div class="form-group">
	  <label class="col-md-4 control-label" for="name">Your name</label>
	  <div class="col-md-4">
	  <input id="name" name="name" type="text" placeholder="name" class="form-control input-md">

	  </div>
	</div>

	<!-- Email -->
	<div class="form-group">
	  <label class="col-md-4 control-label" for="email">Your email</label>
	  <div class="col-md-4">
	  <input id="email" name="email" type="text" placeholder="email@domain.fr" class="form-control input-md">

	  </div>
	</div>

	<!-- News -->
	<div id="news" class="form-group">
	  <label class="col-md-4 control-label" for="news">Interests</label>
	  <div class="col-md-4">
	  <div class="checkbox">
		<label for="news-0">
		  <input type="checkbox" name="news" id="news-0" value="1">
		  Video Games
		</label>
		</div>
	  <div class="checkbox">
		<label for="news-1">
		  <input type="checkbox" name="news" id="news-1" value="2">
		  Embedded
		</label>
		</div>
	  <div class="checkbox">
		<label for="news-2">
		  <input type="checkbox" name="news" id="news-2" value="3">
		  Software programming
		</label>
		</div>
	  <div class="checkbox">
		<label for="news-3">
		  <input type="checkbox" name="news" id="news-3" value="4">
		  Web development
		</label>
		</div>
	  </div>
	</div>

	<!-- Save -->
	<div class="form-group">
	  <label class="col-md-4 control-label" for="save"></label>
	  <div class="col-md-4">
		<button id="save" name="save" class="btn btn-primary">Save</button>
	  </div>
	</div>

	</fieldset>
	</form>
</div>
	<script>
		function guid() {
		  function s4() {
		    return Math.floor((1 + Math.random()) * 0x10000)
		      .toString(16)
		      .substring(1);
		  }
		  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
		    s4() + '-' + s4() + s4() + s4();
		}

		if (!localStorage.id)
			localStorage.id = guid();

		$(window).on('load', function() {
			if (localStorage.name) {
				$("#name").val(localStorage.name);
				$("#header-title").text("Hello " + localStorage.name + " !")
			}
			else {
				$("#header-title").text("Hello stranger !")
			}

			if (localStorage.email)
				$("#email").val(localStorage.email);

			$('#news input').each(function(i, obj) {
				if (localStorage.news) {
					var newsValue = localStorage.news[obj.id];
					if (typeof newsValue !== 'undefined' && newsValue)
						obj.checked = true;
				}
			});

		});

		$("#settings-form").on('submit', function(e) {
			e.preventDefault(e);

			var nameField = $("#name");
			if (nameField.val() !== "")
				localStorage.name = nameField.val();

			var emailField = $("#email");
			if (emailField.val() !== "")
				localStorage.email = emailField.val();

			if (!localStorage.news)
				localStorage.news = {};
			$('#news input').each(function(i, obj) {
				if (obj.checked)
					localStorage.news[obj.id] = true;
				else
					localStorage.news[obj.id] = null;
			});

			$.post("/api/updateUser", {id: localStorage.id,
								name: localStorage.name,
								email: localStorage.email,
								news: localStorage.news});	
		});
	</script>
</body>
</html>
